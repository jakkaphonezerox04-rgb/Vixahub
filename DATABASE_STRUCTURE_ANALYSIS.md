# ğŸ” à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ - à¹€à¸§à¹‡à¸šà¹‚à¸„à¸¥à¸™

## âœ… **à¸ªà¸£à¸¸à¸›: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¢à¸à¸­à¸­à¸à¸ˆà¸²à¸à¸à¸±à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ**

à¸£à¸°à¸šà¸šà¹ƒà¸Šà¹‰ **Firestore** à¹à¸¥à¸°à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸•à¹ˆà¸¥à¸°à¹€à¸§à¹‡à¸šà¹‚à¸„à¸¥à¸™à¸–à¸¹à¸à¹à¸¢à¸à¸­à¸­à¸à¸ˆà¸²à¸à¸à¸±à¸™à¹‚à¸”à¸¢à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸—à¸±à¸šà¸‹à¹‰à¸­à¸™à¸à¸±à¸™

---

## ğŸ“Š **à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ Firestore**

```
firestore (root)
â”‚
â””â”€â”€ cloned_sites/                    â† Collection à¸«à¸¥à¸±à¸
    â”œâ”€â”€ [site_id_1]/                 â† à¹€à¸§à¹‡à¸šà¹‚à¸„à¸¥à¸™à¸—à¸µà¹ˆ 1 (à¹à¸¢à¸à¹‚à¸”à¸¢ ID)
    â”‚   â”œâ”€â”€ users/                   â† à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚   â”‚   â”œâ”€â”€ user_1
    â”‚   â”‚   â”œâ”€â”€ user_2
    â”‚   â”‚   â””â”€â”€ user_3
    â”‚   â”‚
    â”‚   â”œâ”€â”€ settings/                â† à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚   â”‚   â””â”€â”€ site_settings        â† Document
    â”‚   â”‚       â”œâ”€â”€ websiteName
    â”‚   â”‚       â”œâ”€â”€ leaveTypes[]
    â”‚   â”‚       â”œâ”€â”€ deliveryTypes[]
    â”‚   â”‚       â””â”€â”€ fineList[]
    â”‚   â”‚
    â”‚   â”œâ”€â”€ leave_requests/          â† à¸„à¸³à¸‚à¸­à¸¥à¸²à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚   â”‚   â”œâ”€â”€ request_1
    â”‚   â”‚   â”œâ”€â”€ request_2
    â”‚   â”‚   â””â”€â”€ request_3
    â”‚   â”‚
    â”‚   â”œâ”€â”€ delivery_records/        â† à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¸­à¸‡à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚   â”‚   â”œâ”€â”€ delivery_1
    â”‚   â”‚   â””â”€â”€ delivery_2
    â”‚   â”‚
    â”‚   â”œâ”€â”€ reports/                 â† à¸£à¸²à¸¢à¸‡à¸²à¸™à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚   â”‚   â”œâ”€â”€ report_1
    â”‚   â”‚   â””â”€â”€ report_2
    â”‚   â”‚
    â”‚   â””â”€â”€ fine_records/            â† à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¹ˆà¸²à¸›à¸£à¸±à¸šà¸‚à¸­à¸‡à¹€à¸§à¹‡à¸šà¸™à¸µà¹‰
    â”‚       â”œâ”€â”€ fine_1
    â”‚       â””â”€â”€ fine_2
    â”‚
    â”œâ”€â”€ [site_id_2]/                 â† à¹€à¸§à¹‡à¸šà¹‚à¸„à¸¥à¸™à¸—à¸µà¹ˆ 2 (à¹à¸¢à¸à¹‚à¸”à¸¢ ID)
    â”‚   â”œâ”€â”€ users/
    â”‚   â”œâ”€â”€ settings/
    â”‚   â”œâ”€â”€ leave_requests/
    â”‚   â”œâ”€â”€ delivery_records/
    â”‚   â”œâ”€â”€ reports/
    â”‚   â””â”€â”€ fine_records/
    â”‚
    â””â”€â”€ [site_id_3]/                 â† à¹€à¸§à¹‡à¸šà¹‚à¸„à¸¥à¸™à¸—à¸µà¹ˆ 3 (à¹à¸¢à¸à¹‚à¸”à¸¢ ID)
        â”œâ”€â”€ users/
        â”œâ”€â”€ settings/
        â”œâ”€â”€ leave_requests/
        â”œâ”€â”€ delivery_records/
        â”œâ”€â”€ reports/
        â””â”€â”€ fine_records/
```

---

## ğŸ” **à¸à¸²à¸£à¹à¸¢à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Data Isolation)**

### âœ… **1. Settings (à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²)**

```typescript
// Admin à¹à¸à¹‰à¹„à¸‚
doc(firestore, `cloned_sites/${params.id}/settings`, 'site_settings')

// User à¸­à¹ˆà¸²à¸™
doc(firestore, `cloned_sites/${params.id}/settings`, 'site_settings')
```

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:**
- à¹€à¸§à¹‡à¸š ID: `1759332119715` â†’ `cloned_sites/1759332119715/settings/site_settings`
- à¹€à¸§à¹‡à¸š ID: `1759332119716` â†’ `cloned_sites/1759332119716/settings/site_settings`

âŒ **à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¸²à¸‡à¸—à¸±à¸šà¸à¸±à¸™!**

---

### âœ… **2. Users (à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰)**

```typescript
// à¸ªà¸£à¹‰à¸²à¸‡ User
doc(firestore, `cloned_sites/${siteId}/users`, userId)

// Query Users
collection(firestore, `cloned_sites/${params.id}/users`)
```

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:**
- User à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸š A: `cloned_sites/siteA/users/user123`
- User à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸š B: `cloned_sites/siteB/users/user123`

âœ… **à¹à¸¡à¹‰ user123 à¸ˆà¸°à¸Šà¸·à¹ˆà¸­à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ à¸à¹‡à¸­à¸¢à¸¹à¹ˆà¸„à¸™à¸¥à¸°à¹€à¸§à¹‡à¸š à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™!**

---

### âœ… **3. Leave Requests (à¸„à¸³à¸‚à¸­à¸¥à¸²)**

```typescript
// à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸³à¸‚à¸­à¸¥à¸²
collection(firestore, `cloned_sites/${params.id}/leave_requests`)

// à¸­à¹ˆà¸²à¸™à¸„à¸³à¸‚à¸­à¸¥à¸²
collection(firestore, `cloned_sites/${params.id}/leave_requests`)
```

**à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:**
- à¸„à¸³à¸‚à¸­à¸¥à¸²à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸š 1: `cloned_sites/site1/leave_requests/req1`
- à¸„à¸³à¸‚à¸­à¸¥à¸²à¸‚à¸­à¸‡à¹€à¸§à¹‡à¸š 2: `cloned_sites/site2/leave_requests/req1`

âœ… **à¹à¸¢à¸à¸•à¸²à¸¡ Site ID à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ!**

---

### âœ… **4. Delivery Records (à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¸­à¸‡)**

```typescript
collection(firestore, `cloned_sites/${params.id}/delivery_records`)
```

---

### âœ… **5. Reports (à¸£à¸²à¸¢à¸‡à¸²à¸™)**

```typescript
collection(firestore, `cloned_sites/${params.id}/reports`)
```

---

### âœ… **6. Fine Records (à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¹ˆà¸²à¸›à¸£à¸±à¸š)**

```typescript
collection(firestore, `cloned_sites/${params.id}/fine_records`)
```

---

## ğŸ§ª **à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸à¸²à¸£à¹à¸¢à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥**

### **à¸—à¸”à¸ªà¸­à¸š 1: à¸ªà¸£à¹‰à¸²à¸‡ 2 à¹€à¸§à¹‡à¸š**

```javascript
// à¹€à¸§à¹‡à¸š 1: ID = "1759332119715"
cloned_sites/1759332119715/settings/site_settings
  - leaveTypes: ["à¸¥à¸²à¸›à¹ˆà¸§à¸¢", "à¸¥à¸²à¸à¸´à¸ˆ"]

// à¹€à¸§à¹‡à¸š 2: ID = "1759332119716"  
cloned_sites/1759332119716/settings/site_settings
  - leaveTypes: ["à¸¥à¸²à¸„à¸¥à¸­à¸”", "à¸¥à¸²à¸à¸±à¸à¸£à¹‰à¸­à¸™"]
```

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:** âŒ **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™!** à¹à¸•à¹ˆà¸¥à¸°à¹€à¸§à¹‡à¸šà¸¡à¸µ settings à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡

---

### **à¸—à¸”à¸ªà¸­à¸š 2: User à¸Šà¸·à¹ˆà¸­à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™**

```javascript
// à¹€à¸§à¹‡à¸š 1: User "admin"
cloned_sites/site1/users/admin
  - email: admin@site1.com
  - role: admin

// à¹€à¸§à¹‡à¸š 2: User "admin"  
cloned_sites/site2/users/admin
  - email: admin@site2.com
  - role: member
```

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:** âŒ **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™!** admin@site1 â‰  admin@site2

---

### **à¸—à¸”à¸ªà¸­à¸š 3: Leave Request**

```javascript
// User A à¹à¸ˆà¹‰à¸‡à¸¥à¸²à¹ƒà¸™à¹€à¸§à¹‡à¸š 1
cloned_sites/site1/leave_requests/req123
  - user: "UserA"
  - type: "à¸¥à¸²à¸›à¹ˆà¸§à¸¢"

// User A à¹à¸ˆà¹‰à¸‡à¸¥à¸²à¹ƒà¸™à¹€à¸§à¹‡à¸š 2
cloned_sites/site2/leave_requests/req123
  - user: "UserA"
  - type: "à¸¥à¸²à¸à¸´à¸ˆ"
```

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:** âŒ **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™!** à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸¢à¸¹à¹ˆà¸„à¸™à¸¥à¸° path

---

## ğŸ”’ **Security Rules (à¸„à¸§à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²)**

à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¸„à¸§à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Firestore Rules à¹ƒà¸«à¹‰ User à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸”à¹‰à¹à¸„à¹ˆà¹€à¸§à¹‡à¸šà¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow users to access only their cloned site data
    match /cloned_sites/{siteId}/{document=**} {
      allow read, write: if request.auth != null 
                        && request.auth.token.siteId == siteId;
    }
  }
}
```

---

## âœ… **à¸ªà¸£à¸¸à¸›**

| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸ªà¸–à¸²à¸™à¸° | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|--------|-------|----------|
| **à¸à¸²à¸£à¹à¸¢à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥** | âœ… **à¹à¸¢à¸à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ** | à¹ƒà¸Šà¹‰ `params.id` à¹à¸¢à¸à¸—à¸¸à¸ path |
| **Settings** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/settings` |
| **Users** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/users` |
| **Leave Requests** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/leave_requests` |
| **Delivery Records** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/delivery_records` |
| **Reports** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/reports` |
| **Fine Records** | âœ… **à¹„à¸¡à¹ˆà¸—à¸±à¸šà¸à¸±à¸™** | `cloned_sites/${id}/fine_records` |
| **Real-time Sync** | âœ… **à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰** | à¹ƒà¸Šà¹‰ `onSnapshot()` à¸•à¸´à¸”à¸•à¸²à¸¡ |
| **Auto Save** | âœ… **à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰** | Admin à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸±à¸™à¸—à¸µ |

---

## ğŸ¯ **à¸‚à¹‰à¸­à¸ªà¸£à¸¸à¸›**

### âœ… **à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡:**
1. âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¢à¸à¸­à¸­à¸à¸ˆà¸²à¸à¸à¸±à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ
2. âœ… à¹ƒà¸Šà¹‰ `params.id` à¹ƒà¸™à¸—à¸¸à¸ path
3. âœ… à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£ hard-code site ID
4. âœ… à¸¡à¸µ Real-time listener
5. âœ… Auto-save à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰

### âš ï¸ **à¸‚à¹‰à¸­à¸„à¸§à¸£à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡:**
1. âš ï¸ à¸„à¸§à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Firestore Security Rules
2. âš ï¸ à¸„à¸§à¸£à¹€à¸à¸´à¹ˆà¸¡ validation à¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸
3. âš ï¸ à¸„à¸§à¸£à¹€à¸à¸´à¹ˆà¸¡ error handling à¸—à¸µà¹ˆà¸”à¸µà¸‚à¸¶à¹‰à¸™

---

## ğŸ“ **à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™**

### **à¹€à¸§à¹‡à¸š A (ID: 1759332119715)**
```
Settings: cloned_sites/1759332119715/settings/site_settings
Users: cloned_sites/1759332119715/users/*
Leaves: cloned_sites/1759332119715/leave_requests/*
```

### **à¹€à¸§à¹‡à¸š B (ID: 1759332119720)**
```
Settings: cloned_sites/1759332119720/settings/site_settings
Users: cloned_sites/1759332119720/users/*
Leaves: cloned_sites/1759332119720/leave_requests/*
```

âœ… **à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¸²à¸‡à¸—à¸±à¸šà¸à¸±à¸™à¹€à¸¥à¸¢!**

---

**à¸ªà¸£à¸¸à¸›:** à¸£à¸°à¸šà¸šà¸­à¸­à¸à¹à¸šà¸šà¸¡à¸²à¹„à¸”à¹‰à¸”à¸µà¸¡à¸²à¸ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¢à¸à¸­à¸­à¸à¸ˆà¸²à¸à¸à¸±à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ 100% âœ…

















